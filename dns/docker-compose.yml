services:
  dns-honeypot:
    image: alpine:latest
    container_name: dns-honeypot
    command:
      - sh
      - -c
      - |
        apk add --no-cache dnsmasq &&
        cat > /etc/dnsmasq.conf <<'EOF'
        log-queries
        log-facility=-
        port=53
        no-hosts
        no-poll
        # Order matters: resolve container/service names first via Docker DNS,
        # then fall back to public resolvers for everything else.
        strict-order
        no-resolv
        server=127.0.0.11
        server=1.1.1.1
        server=9.9.9.9
        cache-size=0
        dns-forward-max=1000
        listen-address=0.0.0.0
        bind-interfaces
        EOF
        exec dnsmasq --no-daemon --conf-file=/etc/dnsmasq.conf
    expose:
      - "53/udp"
    networks:
      proxynet:
        ipv4_address: 172.20.0.253
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 10m
        max-file: "3"

networks:
  proxynet:
    name: proxynet
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1
    driver_opts:
      encrypted: 'true'
