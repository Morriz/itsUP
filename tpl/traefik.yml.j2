# yaml-language-server: $schema=https://www.schemastore.org/traefik-v3.json
itsup:
  checkNewVersion: false
  sendAnonymousUsage: false

api:
  dashboard: true
  insecure: false

ping:
  entryPoint: web

entryPoints:
  web:
    address: ':8080'
    reusePort: true
    forwardedHeaders:
      trustedIPs:
{%- for ip in trusted_ips_cidrs %}
        - {{ ip }}
{%- endfor %}
    proxyProtocol:
      trustedIPs:
{%- for ip in trusted_ips_cidrs %}
        - {{ ip }}
{%- endfor %}

  web-secure:
    address: ':8443'
    reusePort: true
    forwardedHeaders:
      trustedIPs:
{%- for ip in trusted_ips_cidrs %}
        - {{ ip }}
{%- endfor %}
    proxyProtocol:
      trustedIPs:
{%- for ip in trusted_ips_cidrs %}
        - {{ ip }}
{%- endfor %}

{%- for project in projects %}
  {%- for ingress in project.ingress %}
  {{ ingress.router }}-{{ ingress.hostport or ingress.port }}:
    address: ':{{ ingress.hostport or ingress.port }}/{{ ingress.protocol }}'
    reusePort: true
    forwardedHeaders:
      trustedIPs:
{%- for ip in trusted_ips_cidrs %}
        - {{ ip }}
{%- endfor %}
    proxyProtocol:
      trustedIPs:
{%- for ip in trusted_ips_cidrs %}
        - {{ ip }}
{%- endfor %}
  {%- endfor %}
{%- endfor %}

providers:
  docker:
    exposedByDefault: false
    endpoint: tcp://127.0.0.1:2375
    network: proxynet
  file:
    directory: /etc/traefik/dynamic
    watch: true

accessLog:
  filePath: /var/log/traefik/access.log
  format: json

log:
  level: INFO
