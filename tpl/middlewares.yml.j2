# yaml-language-server: $schema=https://www.schemastore.org/traefik-v3.json
http:
  middlewares:
    default-headers:
      headers:
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        frameDeny: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        #frameDeny: true
        # HSTS - uncomment for HSTS
        #forceSTSHeader: true
        #stsIncludeSubdomains: true
        #stsPreload: true
    removeServiceSelector:
      stripPrefix:
        forceSlash: false
    redirect:
      redirectScheme:
        scheme: https
    traefik-auth:
      basicauth:
        users: {{ traefik_admin }}
    rate-limit:
      rateLimit:
        period: 1s
        average: 100
        burst: 200

    crowdsec:
      plugin:
        bouncer:
          version: v1.4.5
          enabled: {{ crowdsec.enabled }}
          forwardedHeadersTrustedIPs: {{ trusted_ips_cidrs }}
          crowdsecMode: live
          crowdsecAppsecEnabled: true
          crowdsecAppsecFailureBlock: true
          crowdsecAppsecHost: 127.0.0.1:7422
          crowdsecLapiKey: {{ crowdsec.apikey }}
          crowdsecLapiHost: 127.0.0.1:18080
          crowdsecLapiScheme: http
          crowdsecLapiTLSInsecureVerify: false
          crowdsecCapiMachineId: ${CROWDSEC_CAPI_MACHINE_ID}
          crowdsecCapiPassword: ${CROWDSEC_CAPI_PASSWORD}
          crowdsecCapiScenarios:
            - crowdsecurity/http-admin-interface-probing
            - crowdsecurity/http-backdoors-attempts
            - crowdsecurity/http-bad-user-agent
            - crowdsecurity/http-crawl-non_statics
            - crowdsecurity/http-generic-bf
            - crowdsecurity/http-open-proxy
            - crowdsecurity/http-path-traversal-probing
            - crowdsecurity/http-probing
            - crowdsecurity/http-sensitive-files
            - crowdsecurity/http-sqli-probing
            - crowdsecurity/http-xss-probing
            - ltsich/http-w00tw00t